var db = require('iConnectdb.js');
var utl = require('Utility.js');
var pg_query2 = new db.im2(db.get_configdb_adminpoint());


function call_adminPoint(lon, lat, callback)
{
    if (utl.isNumber(lon) && utl.isNumber(lat))
    {
        var query = 'SELECT';
        query += ' "ADMIN_CODE" AS admin_code,';
        query += ' "TAM_TNAME" AS tam_tname,';
        query += ' "AMP_TNAME" AS amp_tname,';
        query += ' "PROV_TNAME" AS prov_tname,';
        query += ' "TAM_ENAME" AS tam_ename,';
        query += ' "AMP_ENAME" AS amp_ename,';
        query += ' "PROV_ENAME" AS prov_ename';
        query += ' FROM tambon WHERE ST_Contains(the_geom, ST_SetSRID(ST_Point(' + utl.sqote(lon) + ',' + utl.sqote(lat) + '), 4326)) LIMIT 1';

        db.get_rows(pg_query2, query, function (rows) {
            if (rows.length > 0) {
                callback(rows);
                return;
            } else {
                callback('No-Query');
                return;
            }
        });
    }
}

exports.call_adminPoint = call_adminPoint;