

var geolib = require('geolib');
var timespan = require('timespan');
var moment = require('moment');

function cal_distance(rlon,rlat,nlon, nlat) {
  //  debugger;
    var distance = geolib.getDistance(
          { latitude: rlat, longitude: rlon }
        , { latitude: nlat, longitude: nlon });

    distance = distance / 1000.0; //km
    return distance;
}

function timenow() {
    var now = moment().format('YYYY-MM-DD HH:mm:ss');
    return now;
}

function diff_min(from_date, to_date) {
    var d1 = new Date(from_date); //'2014-12-04 09:22:10'
    var d2 = new Date(to_date);//'2014-12-04 09:23:13'
    var ts = timespan.fromDates(d1, d2);
    var min = parseInt(ts.totalMinutes());
    // var day = parseInt(ts.totalDays());

    // console.log(allsec);
    return min;
}

function diff_sec(from_date, to_date) {
    var d1 = new Date(from_date); //'2014-12-04 09:22:10'
    var d2 = new Date(to_date);//'2014-12-04 09:23:13'
    var ts = timespan.fromDates(d1, d2);
    var sec = parseInt(ts.totalSeconds());
    // var day = parseInt(ts.totalDays());

    // console.log(allsec);
    return sec;
}



function is_continute(dt_next, dt_next_1, callback) {
    // debugger;
    var res = false;
    var is_cont = diff_min(dt_next, dt_next_1);
    if (is_cont == 1) {
        res = true;
    }

    callback(res);
    return;

}

exports.is_continute = is_continute;
exports.cal_distance = cal_distance;
exports.timenow = timenow;
exports.diff_min = diff_min;
exports.diff_sec = diff_sec;