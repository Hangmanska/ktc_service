    //var http = require('http'); //Https module of Node.js
var fs = require("fs");
var request = require('request');
var config_file = require('pi_config.js');
var config = [];
config_file.getcon_localtunnel(function (res_config) {
    config = res_config;
});



//var api_server = 'http://127.0.0.1:9003/api/upload_image';
var api_server = config.is_infarm.server+'/'+config.is_infarm.api_uppic;
//var file_name = '01-20161126024100-snapshot.jpg';
//var image = __dirname + '/'+file_name;



function upload_image(fileBase64Encoded, file_name, camera_id, cb) {

//console.log(buff);
  var r = request.post(api_server, function (err, httpResponse, body)
{
    if (err)
    {
        cb(err);
    }
    cb(null, body);
});

var form = r.form();
//form.append('file', buff, { filename: 'temp.txt' });
form.append('file', fileBase64Encoded);
form.append('file_name', file_name);
form.append('camera_id', camera_id);
}

function pi_upload2_serv(file_name, camera_id, callback)
{
   // console.log(file_name);

    var image = '/var/lib/motion/'+ file_name;
    var buff = new Buffer(fs.readFileSync(image)).toString("base64");

    upload_image(buff, file_name, camera_id, function (xres)
    {
        callback(xres);
        return;
    });

}

exports.pi_upload2_serv = pi_upload2_serv;
